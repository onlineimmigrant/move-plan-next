# System Architecture - Waiting Room & Instant Meetings

## ðŸ—ï¸ Component Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         MeetingsAdminModal                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    AdminBookingsList                          â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚          WaitingRoomControls (Top Panel)              â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Shows all waiting participants                     â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Admit/Deny buttons                                 â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Real-time polling (5s interval)                    â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚  [Status Filter â–¼] [+ Send Instant Invite]  ðŸ‘¥ 12     â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚  Booking List                                          â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Shows all bookings                                  â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Filter by status                                    â”‚   â”‚  â”‚
â”‚  â”‚  â”‚  â€¢ Join/Cancel actions                                 â”‚   â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       InstantMeetingModal                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Meeting Type: [Dropdown          â–¼]                         â”‚  â”‚
â”‚  â”‚  Title:        [Quick Consultation_________________]         â”‚  â”‚
â”‚  â”‚  Customer:     [John Doe___________________________]         â”‚  â”‚
â”‚  â”‚  Email:        [john@example.com___________________]         â”‚  â”‚
â”‚  â”‚  Duration:     [30] minutes                                  â”‚  â”‚
â”‚  â”‚  Notes:        [___________________________________]         â”‚  â”‚
â”‚  â”‚                [___________________________________]         â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  [Cancel]  [ðŸ“§ Send Invite]                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ManagedVideoCall Component                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  if (status === 'waiting')                                    â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚              WaitingRoom Component                      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  ðŸ”µ Waiting for host to let you in...                  â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Meeting: Quick Consultation                           â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Host: Sarah Admin                                     â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Scheduled: 2:00 PM                                    â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Waiting time: 00:45                                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  (Polls every 3s for status update)                    â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  else                                                         â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚              VideoCallModal                             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  [Video call interface with Twilio]                    â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸ”„ Data Flow Diagrams

### Waiting Room Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Customer â”‚         â”‚ useMeeting     â”‚         â”‚   API    â”‚
â”‚  Browser â”‚         â”‚ Launcher Hook  â”‚         â”‚ Routes   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                        â”‚                      â”‚
     â”‚ 1. Click meeting link  â”‚                      â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                      â”‚
     â”‚                        â”‚                      â”‚
     â”‚                        â”‚ 2. Check: isEarly?   â”‚
     â”‚                        â”‚    !isAdmin?         â”‚
     â”‚                        â”‚    !isHost?          â”‚
     â”‚                        â”‚                      â”‚
     â”‚                        â”‚ 3. POST /waiting-    â”‚
     â”‚                        â”‚    room/enter        â”‚
     â”‚                        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                        â”‚                      â”‚
     â”‚                        â”‚ 4. Status: waiting   â”‚
     â”‚                        â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                        â”‚                      â”‚
     â”‚ 5. Render WaitingRoom  â”‚                      â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                      â”‚
     â”‚                        â”‚                      â”‚
     â”‚ â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— â”‚                      â”‚
     â”‚ â•‘  Waiting Screen    â•‘ â”‚                      â”‚
     â”‚ â•‘  (polls every 3s)  â•‘ â”‚                      â”‚
     â”‚ â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚                      â”‚
     â”‚                        â”‚                      â”‚
     â”‚ 6. Poll: GET booking/idâ”‚                      â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                        â”‚                      â”‚
     â”‚ 7. status: still waiting                      â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                        â”‚                      â”‚
     â”‚ ... (continues polling until status changes)  â”‚
     â”‚                        â”‚                      â”‚

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Host   â”‚         â”‚ WaitingRoom    â”‚         â”‚   API    â”‚
â”‚  Browser â”‚         â”‚ Controls       â”‚         â”‚ Routes   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                        â”‚                      â”‚
     â”‚ 1. Open admin panel    â”‚                      â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                      â”‚
     â”‚                        â”‚                      â”‚
     â”‚                        â”‚ 2. GET /waiting-room â”‚
     â”‚                        â”‚    /enter?hostId=... â”‚
     â”‚                        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                        â”‚                      â”‚
     â”‚                        â”‚ 3. List of waiting   â”‚
     â”‚                        â”‚    participants      â”‚
     â”‚                        â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                        â”‚                      â”‚
     â”‚ 4. Show participant    â”‚                      â”‚
     â”‚    cards with buttons  â”‚                      â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                      â”‚
     â”‚                        â”‚                      â”‚
     â”‚ â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•— â”‚                      â”‚
     â”‚ â•‘ John Doe           â•‘ â”‚                      â”‚
     â”‚ â•‘ john@example.com   â•‘ â”‚                      â”‚
     â”‚ â•‘ Waiting: 00:45     â•‘ â”‚                      â”‚
     â”‚ â•‘ [Admit]  [Deny]    â•‘ â”‚                      â”‚
     â”‚ â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚                      â”‚
     â”‚                        â”‚                      â”‚
     â”‚ 5. Click "Admit"       â”‚                      â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                      â”‚
     â”‚                        â”‚                      â”‚
     â”‚                        â”‚ 6. POST /waiting-roomâ”‚
     â”‚                        â”‚    /approve          â”‚
     â”‚                        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
     â”‚                        â”‚                      â”‚
     â”‚                        â”‚ 7. Update booking    â”‚
     â”‚                        â”‚    status: in_progressâ”‚
     â”‚                        â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                        â”‚                      â”‚
     â”‚ 8. Toast: "Admitted!"  â”‚                      â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                      â”‚
     â”‚                        â”‚                      â”‚
     
Customer's waiting room component detects status change â†’ Transitions to VideoCallModal
```

### Instant Meeting Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Admin  â”‚         â”‚ InstantMeeting â”‚         â”‚   API    â”‚         â”‚ Customer â”‚
â”‚  Browser â”‚         â”‚     Modal      â”‚         â”‚ Routes   â”‚         â”‚  Email   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
     â”‚                        â”‚                      â”‚                      â”‚
     â”‚ 1. Click "+ Send       â”‚                      â”‚                      â”‚
     â”‚    Instant Invite"     â”‚                      â”‚                      â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                      â”‚                      â”‚
     â”‚                        â”‚                      â”‚                      â”‚
     â”‚ 2. Show modal form     â”‚                      â”‚                      â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                      â”‚                      â”‚
     â”‚                        â”‚                      â”‚                      â”‚
     â”‚ 3. Fill form & submit  â”‚                      â”‚                      â”‚
     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                      â”‚                      â”‚
     â”‚                        â”‚                      â”‚                      â”‚
     â”‚                        â”‚ 4. POST /instant-    â”‚                      â”‚
     â”‚                        â”‚    invite            â”‚                      â”‚
     â”‚                        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                      â”‚
     â”‚                        â”‚                      â”‚                      â”‚
     â”‚                        â”‚                      â”‚ 5. Create booking    â”‚
     â”‚                        â”‚                      â”‚    scheduled_at=NOW  â”‚
     â”‚                        â”‚                      â”‚    status=confirmed  â”‚
     â”‚                        â”‚                      â”‚                      â”‚
     â”‚                        â”‚                      â”‚ 6. POST /send-email  â”‚
     â”‚                        â”‚                      â”‚    type=meeting_     â”‚
     â”‚                        â”‚                      â”‚    invitation        â”‚
     â”‚                        â”‚                      â”‚                      â”‚
     â”‚                        â”‚                      â”‚ 7. AWS SES sends     â”‚
     â”‚                        â”‚                      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> â”‚
     â”‚                        â”‚                      â”‚                      â”‚
     â”‚                        â”‚ 8. Success response  â”‚                      â”‚
     â”‚                        â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                      â”‚
     â”‚                        â”‚                      â”‚                      â”‚
     â”‚ 9. Toast: "Invite sent"â”‚                      â”‚                      â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                      â”‚                      â”‚
     â”‚                        â”‚                      â”‚                      â”‚
     â”‚ 10. Close modal        â”‚                      â”‚                      â”‚
     â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                      â”‚                      â”‚
     â”‚                        â”‚                      â”‚                      â”‚
     â”‚                        â”‚                      â”‚    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•—   â”‚
     â”‚                        â”‚                      â”‚    â•‘ Email with  â•‘   â”‚
     â”‚                        â”‚                      â”‚    â•‘ Join button â•‘   â”‚
     â”‚                        â”‚                      â”‚    â•šâ•â•â•â•â•â•â”¬â•â•â•â•â•â•â•   â”‚
     â”‚                        â”‚                      â”‚           â”‚          â”‚
     â”‚                        â”‚                      â”‚    11. Click "Join   â”‚
     â”‚                        â”‚                      â”‚        Video Meeting"â”‚
     â”‚                        â”‚                      â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
     â”‚                        â”‚                      â”‚                      â”‚
     â”‚                        â”‚    Video call launches instantly            â”‚
```

---

## ðŸ—„ï¸ Database Schema Changes

```sql
-- Before Migration
CREATE TYPE booking_status AS ENUM (
  'scheduled',
  'confirmed',
  'in_progress',
  'completed',
  'cancelled',
  'no_show'
);

CREATE TABLE bookings (
  id UUID PRIMARY KEY,
  organization_id UUID NOT NULL,
  meeting_type_id UUID NOT NULL,
  host_user_id UUID,
  customer_email TEXT NOT NULL,
  customer_name TEXT NOT NULL,
  title TEXT NOT NULL,
  scheduled_at TIMESTAMPTZ NOT NULL,
  duration_minutes INTEGER NOT NULL,
  timezone TEXT NOT NULL,
  status booking_status NOT NULL DEFAULT 'scheduled',
  notes TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW(),
  updated_at TIMESTAMPTZ DEFAULT NOW()
);

-- After Migration (NEW FIELDS)
ALTER TYPE booking_status ADD VALUE 'waiting';  -- â­ NEW

ALTER TABLE bookings ADD COLUMN waiting_since TIMESTAMPTZ;        -- â­ NEW
ALTER TABLE bookings ADD COLUMN approved_by UUID                  -- â­ NEW
  REFERENCES profiles(id);
ALTER TABLE bookings ADD COLUMN approved_at TIMESTAMPTZ;          -- â­ NEW
ALTER TABLE bookings ADD COLUMN rejected_by UUID                  -- â­ NEW
  REFERENCES profiles(id);
ALTER TABLE bookings ADD COLUMN rejected_at TIMESTAMPTZ;          -- â­ NEW
ALTER TABLE bookings ADD COLUMN rejection_reason TEXT;            -- â­ NEW

CREATE INDEX idx_bookings_status ON bookings(status);             -- â­ NEW
```

---

## ðŸ“¡ API Endpoints Reference

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Waiting Room APIs                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  POST /api/meetings/waiting-room/enter                             â”‚
â”‚  â”œâ”€ Body: { bookingId }                                            â”‚
â”‚  â”œâ”€ Action: Set status to 'waiting', record waiting_since          â”‚
â”‚  â””â”€ Response: { booking, waiting: true }                           â”‚
â”‚                                                                     â”‚
â”‚  GET /api/meetings/waiting-room/enter                              â”‚
â”‚  â”œâ”€ Query: ?hostUserId={id}&organizationId={id}                    â”‚
â”‚  â”œâ”€ Action: List all waiting participants for host                 â”‚
â”‚  â””â”€ Response: { bookings: [...] }                                  â”‚
â”‚                                                                     â”‚
â”‚  POST /api/meetings/waiting-room/approve                           â”‚
â”‚  â”œâ”€ Body: { bookingId }                                            â”‚
â”‚  â”œâ”€ Auth: Must be host or admin                                    â”‚
â”‚  â”œâ”€ Action: Set status to 'in_progress', record approval           â”‚
â”‚  â””â”€ Response: { booking, approved: true }                          â”‚
â”‚                                                                     â”‚
â”‚  POST /api/meetings/waiting-room/reject                            â”‚
â”‚  â”œâ”€ Body: { bookingId, reason? }                                   â”‚
â”‚  â”œâ”€ Auth: Must be host or admin                                    â”‚
â”‚  â”œâ”€ Action: Set status to 'cancelled', record rejection            â”‚
â”‚  â””â”€ Response: { booking, rejected: true }                          â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Instant Meeting API                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  POST /api/meetings/instant-invite                                 â”‚
â”‚  â”œâ”€ Body: {                                                        â”‚
â”‚  â”‚    meeting_type_id: string,                                     â”‚
â”‚  â”‚    customer_email: string,                                      â”‚
â”‚  â”‚    customer_name: string,                                       â”‚
â”‚  â”‚    title: string,                                               â”‚
â”‚  â”‚    duration_minutes?: number,                                   â”‚
â”‚  â”‚    notes?: string,                                              â”‚
â”‚  â”‚    send_email?: boolean                                         â”‚
â”‚  â”‚  }                                                               â”‚
â”‚  â”œâ”€ Auth: Must be admin                                            â”‚
â”‚  â”œâ”€ Action: Create booking with NOW timestamp, send email          â”‚
â”‚  â””â”€ Response: { booking, success: true }                           â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          Email API                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚  POST /api/send-email                                              â”‚
â”‚  â”œâ”€ Body: {                                                        â”‚
â”‚  â”‚    type: 'meeting_invitation',                                  â”‚
â”‚  â”‚    to: string,                                                  â”‚
â”‚  â”‚    organization_id: string,                                     â”‚
â”‚  â”‚    name: string,                                                â”‚
â”‚  â”‚    emailDomainRedirection: string,                              â”‚
â”‚  â”‚    placeholders: {                                              â”‚
â”‚  â”‚      meeting_title: string,                                     â”‚
â”‚  â”‚      host_name: string,                                         â”‚
â”‚  â”‚      meeting_time: string,                                      â”‚
â”‚  â”‚      duration_minutes: string,                                  â”‚
â”‚  â”‚      meeting_notes: string,                                     â”‚
â”‚  â”‚      meeting_notes_html: string                                 â”‚
â”‚  â”‚    }                                                             â”‚
â”‚  â”‚  }                                                               â”‚
â”‚  â”œâ”€ Action: Send HTML + plain text email via AWS SES               â”‚
â”‚  â””â”€ Response: { success: true }                                    â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ðŸŽ¨ Component Hierarchy

```
App
â””â”€â”€ MeetingContext (provides meeting state)
    â”œâ”€â”€ MeetingsAdminModal
    â”‚   â””â”€â”€ AdminBookingsList
    â”‚       â”œâ”€â”€ WaitingRoomControls
    â”‚       â”‚   â”œâ”€â”€ Fetches waiting participants
    â”‚       â”‚   â”œâ”€â”€ Maps to participant cards
    â”‚       â”‚   â””â”€â”€ Approve/Deny buttons
    â”‚       â”‚
    â”‚       â”œâ”€â”€ InstantMeetingModal (when open)
    â”‚       â”‚   â”œâ”€â”€ Form fields
    â”‚       â”‚   â”œâ”€â”€ Meeting type selector
    â”‚       â”‚   â””â”€â”€ Submit â†’ API call
    â”‚       â”‚
    â”‚       â””â”€â”€ Booking list items
    â”‚           â”œâ”€â”€ Status badge
    â”‚           â”œâ”€â”€ Join button
    â”‚           â””â”€â”€ Cancel button
    â”‚
    â””â”€â”€ ManagedVideoCall
        â”œâ”€â”€ if (status === 'waiting')
        â”‚   â””â”€â”€ WaitingRoom
        â”‚       â”œâ”€â”€ Meeting info display
        â”‚       â”œâ”€â”€ Waiting timer
        â”‚       â”œâ”€â”€ Animated indicator
        â”‚       â””â”€â”€ Status polling
        â”‚
        â””â”€â”€ else
            â””â”€â”€ VideoCallModal
                â””â”€â”€ Twilio video interface
```

---

## ðŸ” Security & Permissions

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Access Control Matrix                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Action           â”‚ Customer     â”‚ Host         â”‚ Admin             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Enter waiting    â”‚ âœ… Own mtg   â”‚ âœ… Own mtg   â”‚ âœ… Any mtg        â”‚
â”‚ room             â”‚              â”‚              â”‚                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ View waiting     â”‚ âŒ No        â”‚ âœ… Own mtgs  â”‚ âœ… All org mtgs   â”‚
â”‚ participants     â”‚              â”‚              â”‚                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Approve          â”‚ âŒ No        â”‚ âœ… Own mtgs  â”‚ âœ… All org mtgs   â”‚
â”‚ participant      â”‚              â”‚              â”‚                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Reject           â”‚ âŒ No        â”‚ âœ… Own mtgs  â”‚ âœ… All org mtgs   â”‚
â”‚ participant      â”‚              â”‚              â”‚                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Send instant     â”‚ âŒ No        â”‚ âŒ No        â”‚ âœ… Yes            â”‚
â”‚ invite           â”‚              â”‚              â”‚                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ View all         â”‚ âŒ No        â”‚ âœ… Own mtgs  â”‚ âœ… All org mtgs   â”‚
â”‚ bookings         â”‚              â”‚              â”‚                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Validation Points:
1. API Level: Check Authorization header + user profile
2. Component Level: Hide/show based on role
3. Database Level: RLS policies enforce org boundaries
```

---

## â±ï¸ Timing & Polling

```
WaitingRoom Component (Customer)
â”œâ”€â”€ Initial render
â”œâ”€â”€ Poll every 3 seconds
â”‚   â””â”€â”€ GET /api/meetings/bookings/{id}
â”‚       â”œâ”€â”€ if status changed to 'in_progress'
â”‚       â”‚   â””â”€â”€ Call onStatusChange â†’ Switch to video
â”‚       â”œâ”€â”€ if status changed to 'cancelled'
â”‚       â”‚   â””â”€â”€ Show rejection message
â”‚       â””â”€â”€ else continue polling
â””â”€â”€ Show elapsed time counter (updates every 1s)

WaitingRoomControls Component (Host)
â”œâ”€â”€ Initial render
â”œâ”€â”€ Poll every 5 seconds
â”‚   â””â”€â”€ GET /api/meetings/waiting-room/enter?host...
â”‚       â””â”€â”€ Update participant list
â”œâ”€â”€ On approve click
â”‚   â”œâ”€â”€ POST /api/meetings/waiting-room/approve
â”‚   â”œâ”€â”€ Show success toast
â”‚   â””â”€â”€ Remove from list
â””â”€â”€ On deny click
    â”œâ”€â”€ POST /api/meetings/waiting-room/reject
    â”œâ”€â”€ Show success toast
    â””â”€â”€ Remove from list
```

---

## ðŸ“§ Email Template Structure

```html
<!DOCTYPE html>
<html>
<head>
  <style>
    .button { 
      background: #4F46E5; 
      color: white; 
      padding: 12px 24px; 
      border-radius: 6px;
      text-decoration: none;
    }
    .info-box {
      background: #F3F4F6;
      border-left: 4px solid #4F46E5;
      padding: 16px;
      margin: 20px 0;
    }
  </style>
</head>
<body>
  <h1>Hi {{name}},</h1>
  <p>You've been invited to a video meeting!</p>
  
  <div class="info-box">
    <div><strong>Meeting:</strong> {{meeting_title}}</div>
    <div><strong>Host:</strong> {{host_name}}</div>
    <div><strong>Date & Time:</strong> {{meeting_time}}</div>
    <div><strong>Duration:</strong> {{duration_minutes}} minutes</div>
    {{meeting_notes_html}}
  </div>
  
  <p style="text-align: center;">
    <a href="{{emailDomainRedirection}}" class="button">
      Join Video Meeting
    </a>
  </p>
</body>
</html>
```

---

**ðŸ“Œ Remember: Apply the database migration first before testing!**

See: `/APPLY_MIGRATION_FIRST.md`
